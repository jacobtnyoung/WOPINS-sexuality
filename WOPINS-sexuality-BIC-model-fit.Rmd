---
title: "WOPINS Sexuality BIC Analysis"
output: 
  html_document:
    df_print: paged
    theme: lumen
    highlight: haddock
    toc: yes
    toc_float: yes
    code_fold: show
    self_contained: true
---

<style>
body {
text-align: justify}
</style>


```{r}

# set the defaults for the codechunks
knitr::opts_chunk$set( eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE )

```


```{r setup}

# ----------
# Setup 

# Clear the workspace
rm( list = ls() )

# libraries
library( here ) # for calling local directory
library( dplyr ) # for working with the data
library( network ) # for creating the network object
library( sna ) # for working with the network
library( ergm ) # for erg models
library( pander ) # for tables


# run the script to create the networks with the attributes
source( here( "WOPINS-sexuality-BUILD.R" ) )

```

This file reports the results for various BIC values for the structural terms.

```{r build-functions}

# ----
# Build the function for the separate networks
eval.bic <- function( net, I, E ){
  model.bics <- matrix( 0, nrow = length( I ), ncol = length( E ) )
  
  for ( i in 1:length( I ) ){
    for ( j in 1:length( E ) ){
      model.bics[i,j] <- 
        summary( ergm( net ~ edges
                     + mutual + twopath 
                     + gwidegree( decay = I[i], fixed = TRUE )
                     + gwesp( E[j], fixed = TRUE ) ) )$bic
    }
  }
  
  rownames( model.bics ) <- paste("I @", as.character( I ) )
  colnames( model.bics ) <- paste("E @", as.character( E ) )
  
  return( model.bics )
}

# ----
# build the function for the pooled networks (this includes the constraint)
eval.bic.p <- function( net, I, E ){
  model.bics <- matrix( 0, nrow = length( I ), ncol = length( E ) )
  
  for ( i in 1:length( I ) ){
    for ( j in 1:length( E ) ){
      model.bics[i,j] <- 
        summary( ergm( net ~ edges
                     + mutual + twopath 
                     + gwidegree( decay = I[i], fixed = TRUE )
                     + gwesp( E[j], fixed = TRUE ),
                     constraints = ~ blocks( "block", levels2 = c( 2, 3 ) ) ) )$bic
    }
  }
  
  rownames( model.bics ) <- paste("I @", as.character( I ) )
  colnames( model.bics ) <- paste("E @", as.character( E ) )
  
  return( model.bics )
}

```

# Friendship

Begin with some rough estimates, prior to fine tuning.

```{r, echo=TRUE}

# Set the range of values to examine
I <- seq( 0, 1.5, by = 0.25 )
E <- seq( 0, 1.5, by = 0.25 )

```

```{r, cache=TRUE}

# Set the seed to reproduce results.
set.seed( 12345 )

# Estimate the models
bic.u2   <- eval.bic( u2.net, I, E )
bic.u3   <- eval.bic( u3.net, I, E )

bic.pool <- eval.bic.p( u2.u3.pooled.net, I, E )

```

```{r}

# plot the BICs based on the model terms
#par( mfrow = c( 2,2 ) )
#plot( bic.u2[1:nrow( bic.u2 ),], bic.u2[,1:ncol( bic.u2 )], type="b", main="BIC for GW terms (u2)", xlab = "gwindegree", ylab = "gwesp")
#plot( bic.u3[1:nrow( bic.u3 ),], bic.u3[,1:ncol( bic.u3 )], type="b", main="BIC for GW terms (u3)", xlab = "gwindegree", ylab = "gwesp")
#plot( bic.pool[1:nrow( bic.pool ),], bic.pool[,1:ncol( bic.pool )], type="b", main="BIC for GW terms (pooled)", xlab = "gwindegree", ylab = "gwesp")
#par( mfrow = c( 1,1 ) )

```

```{r}

bic.u2 == min( bic.u2 )

```

The table shows that the best fitting value for the `gwindegree` term is 0.75 and the `gwesp` term is 1.5.

```{r}

bic.u3 == min( bic.u3 )

```

The table shows that the best fitting value for the `gwindegree` term is 0.75 and the `gwesp` term is 1.25.

```{r}

bic.pool == min( bic.pool )

```

The table shows that the best fitting value for the `gwindegree` term is ??? and the `gwesp` term is ???.

<br>

----

# Power

HERE WITH WORKING THROUGH

----

<br>
<br>

###### ***Last updated `r format(Sys.time(), '%d %B, %Y')`***